@{
    ViewBag.Title = "Unity Testing Page";
}

<h2>@ViewBag.Title</h2>
<div id="unityPlayer">
    <a href="#" id="markGameObject1" class="button">markGameObject1</a>
    <a href="#" id="checkGameObject1" class="button">checkGameObject1</a>
    <a href="#" id="getGameObjectInfo1" class="button">getGameObjectInfo1</a>

    <div class="missing">
        <a href="http://unity3d.com/webplayer/" title="Unity Web Player. Install now!">
            <img alt="Unity Web Player. Install now!" src="http://webplayer.unity3d.com/installation/getunity.png" width="193" height="63" />
        </a>
    </div>
    <div class="broken">
        <a href="http://unity3d.com/webplayer/" title="Unity Web Player. Install now! Restart your browser after install.">
            <img alt="Unity Web Player. Install now! Restart your browser after install." src="http://webplayer.unity3d.com/installation/getunityrestart.png" width="193" height="63" />
        </a>
    </div>
</div>

@section Scripts {
    <script type="text/javascript" src="@Url.Content("~/Scripts/UnityObject2.js")"></script>
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        //main function
        Request = function (command, data, result) {
            $.post("@Url.Action("", "Api")/" + command, data, result);
        };

        //command function
        markGameObject = function (id) {
            Request("markGameObject", { id: id }, function (data) {
                if (data.success)
                    alert('ok');
                else
                    alert(data.message);
            });
        };

        checkGameObject = function (id) {
            Request("checkGameObject", { id: id }, function (data) {
                if (data.success)
                    alert(data.state);
                else
                    alert(data.message);
            });
        };

        getGameObjectInfo = function (id, full) {
            Request("getGameObjectInfo", { id: id, full: full }, function (data) {
                if (data.success)
                    alert(data.name + " " + data.canNotified + " " + data.description);
                else
                    alert(data.message);
            });
        };

        //fake functions
        $('#markGameObject1').click(function () { markGameObject(1); });
        $('#checkGameObject1').click(function () { checkGameObject(1); });
        $('#getGameObjectInfo1').click(function () { getGameObjectInfo(1, false); });
    </script>

    <script type="text/javascript">
    var config = {
        width: 960,
        height: 600,
        params: { enableDebugging: "0" }

    };
    var u = new UnityObject2(config);

    jQuery(function () {
        var $missingScreen = jQuery("#unityPlayer").find(".missing");
        var $brokenScreen = jQuery("#unityPlayer").find(".broken");
        $missingScreen.hide();
        $brokenScreen.hide();

        u.observeProgress(function (progress) {
            switch (progress.pluginStatus) {
                case "broken":
                    $brokenScreen.find("a").click(function (e) {
                        e.stopPropagation();
                        e.preventDefault();
                        u.installPlugin();
                        return false;
                    });
                    $brokenScreen.show();
                    break;
                case "missing":
                    $missingScreen.find("a").click(function (e) {
                        e.stopPropagation();
                        e.preventDefault();
                        u.installPlugin();
                        return false;
                    });
                    $missingScreen.show();
                    break;
                case "installed":
                    $missingScreen.remove();
                    break;
                case "first":
                    break;
            }
        });
        u.initPlugin(jQuery("#unityPlayer")[0], '@Url.Content("~/Content/Unity.bin")');
    });
    </script>
}
